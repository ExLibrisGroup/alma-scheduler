<div class="tiles-grid-tile" id="primo-explore-appointment-scheduler" ng-if="$ctrl.parentCtrl.$stateParams.section=='overview'">
  <prm-spinner ng-if="vm.loading" class="default-loader dark-on-light overlay-cover no-text" layout="row" layout-align="center center"></prm-spinner>
  <div class="tile-content layout-column">
    <div class="tile-header layout-column">
      <div layout="row" layout-align="space-between" class="layout-align-space-between-stretch layout-row">
        <h2 class="header-link light-text" tabindex="0">
          <span>{{translate('appointments')}}</span>
        </h2>
      </div>
    </div>
    <div ng-if="vm.msg" class="layout-margin layout-padding" ng-style="{'background-color': vm.msg.type == 'warning' ? '#F9A92E' : (vm.msg.type == 'error' ? '#FA4B51' : '#62C131')}">
      <a class="close" (click)="clearAlert()">&times;</a>
      <span>{{ vm.msg.text }}</span>
    </div>
    <div class="layout-padding layout-column">
      <ng-template ng-if="vm.appointments">
        <md-list flex ng-if="vm.appointments.length && vm.appointments.length > 0">
          <md-subheader class="md-no-sticky">{{translate('appointmentlist')}}</md-subheader>
          <md-list-item class="md-2-line" ng-repeat="appt in vm.appointments">
            <div class="md-list-item-text">
              <h3>{{ appt.startTime | formatDate:vm.locale }}</h3>
              <p>{{ appt.location }}</p>
            </div>
            <button 
              aria-label="Cancel appointment"
              ng-click="cancel(appt.id)"
              class="button-with-icon zero-margin md-button md-primoExplore-theme md-ink-ripple"
              type="button"
            >
              <prm-icon icon-type="svg" svg-icon-set="content" icon-definition="ic_clear_24px"></prm-icon>
              <span>{{translate('cancel')}}</span>
            </button>                
          </md-list-item>           
        </md-list>
        <p ng-if="!vm.appointments.length || vm.appointments.length == 0">{{translate('noappointments')}}</p>
      </ng-template>
    </div>
    <!---->
    <div>
      <button 
        aria-label="Add appointment"
        ng-click="vm.showForm=true; newEventChanged();"
        class="button-with-icon zero-margin md-button md-primoExplore-theme md-ink-ripple"
        type="button"
      >
        <prm-icon icon-type="svg" svg-icon-set="content" icon-definition="ic_add_24px"></prm-icon>
        <span>{{translate('addappointment')}}</span>
      </button>
    </div>
    <!---->
    <md-card ng-if="vm.showForm">
      <md-card-title>
        <md-card-title-text>
          <span class="md-headline">{{translate('newappointment')}}</span>
        </md-card-title-text>
      </md-card-title>
      <md-card-content>
        <md-input-container class="underlined-input md-primoExplore-theme layout-column" layout="column">
          <label>{{translate('location')}}</label> 
          <md-select ng-model="vm.newEvent.location" ng-change="newEventChanged()">
            <md-option ng-repeat="location in vm.config.locations" ng-value="location.id">
              {{location.name}}
            </md-option>
          </md-select>
          <div class="md-errors-spacer"></div>
        </md-input-container>
        <md-input-container class="underlined-input">
          <label>{{translate('date')}}</label>
          <md-datepicker ng-model="vm.newEvent.startDate" md-placeholder="Select date"
            input-aria-describedby="datepicker-description"
            input-aria-labelledby="datepicker-header"
            ng-change="newEventChanged()"
            md-min-date="vm.minDate"
            style="display: inline-block; margin-right: 15px;"
          ></md-datepicker>  
        </md-input-container>
        <md-input-container class="underlined-input">
          <label>{{translate('starttime')}}</label>
          <md-select ng-model="vm.newEvent.startTime" style="margin: unset">
            <md-option ng-repeat="slot in vm.slots" ng-value="slot">
              {{ slot | formatTime:vm.locale }}
            </md-option>
          </md-select>
        </md-input-container>
      </md-card-content>
      <md-card-actions layout="row" layout-align="end center">
        <md-button ng-click="hideForm()">{{translate('cancel')}}</md-button>
        <md-button ng-click="add()" ng-disabled="!(vm.newEvent.startTime && vm.newEvent.location)">{{translate('save')}}</md-button>
      </md-card-actions>
    </md-card>
  </div>
</div> 